<!DOCTYPE html>
<meta charset="utf-8">
<style>

circle {
  fill: rgb(31, 119, 180);
  fill-opacity: .25;
  stroke: rgb(31, 119, 180);
  stroke-width: 1px;
}

.leaf circle {
  fill: #ff7f0e;
  fill-opacity: 1;
}

text {
  font: 10px sans-serif;
  text-anchor: middle;
}

</style>
<svg width="960" height="960"></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>	
	var Containers = [];
	loadXML("./XML Files/hadoop_all.xml");

	//Functions
	function loadXML(path)
	{
		//Specify the xml file and the callbackwith D3.
		d3.xml(path, xmlCallback);
	}

	function CreateJSON(data)
	{
		//Create JSON structure for the Pack.
		var containers = data.querySelectorAll("container");
		for(var k = 0; k < containers.length; k++)
		{
			var container = containers[k];
			var packages = container.querySelectorAll("namespace");
			var containerSize = packages.length;
			var packageArray = [];

			for(var j = 0; j < containerSize; j++)
			{
				var packageSize = packages[j].querySelectorAll("type").length;
				var packageName = packages[j].getAttribute("name");

				var strArr = packageName.split(".")
				if(strArr[0] != "java" || !packageName.includes("com.google"))
				{
					packageArray.push({"name": packageName, "size": packageSize});
				}
			}				

			Containers.push({"name": container.getAttribute("name"), "children": packageArray});//, "size": packages.length});
		}

		var context = data.querySelectorAll("context")[0].getAttribute("name");
		return {"name": context, "children": Containers}
	}

	function findPackage(collection, namespace)
	{
		return collection.filter(function(data){
			return data.id == namespace;
		})
	}

	function xmlCallback(error, data)
	{
		if(error) 
		{
			throw error
		}
		else
		{
			//Create the JSON objects using the CDA generated XML.
			var jsondata = CreateJSON(data);

			var svg = d3.select("svg"),
			    diameter = +svg.attr("width"),
			    g = svg.append("g").attr("transform", "translate(2,2)"),
			    format = d3.format(",d");

			var pack = d3.pack()
			    .size([diameter - 4, diameter - 4]);


			  root = d3.hierarchy(jsondata)
			      .sum(function(d) { return d.size; })
			      .sort(function(a, b) { return b.value - a.value; });

			  var node = g.selectAll(".node")
			    .data(pack(root).descendants())
			    .enter().append("g")
			      .attr("class", function(d) { return d.children ? "node" : "leaf node"; })
			      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });

			  node.append("title")
			      .text(function(d) { return d.data.name + "\n" + format(d.value); });

			  node.append("circle")
			      .attr("r", function(d) { return d.r; });
			      //.attr("visibility", function(d){ return d.children? "visible" : "hidden"; });

			  node.filter(function(d) { return !d.children; }).append("text")
			      .attr("dy", "0.3em")
			      .text(function(d) { return d.data.name.substring(0, d.r / 3); });
			       //.attr("visibility", function(d){ return d.children? "visible" : "hidden"; });
		}
	}		
</script>


